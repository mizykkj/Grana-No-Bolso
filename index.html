<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central de Jogos - Jogue Agora!</title>
    <link rel="stylesheet" href="style.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9402908836616610"
         crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <div class="top-page-actions">
            <div id="loggedInUserInfo" style="display: none;">
                <span id="loggedInUserEmail" class="user-email-display"></span>
                <a href="#" id="logoutModalButton" class="top-nav-link logout-link">Sair</a>
            </div>
            <a href="#" id="loginTriggerLink" class="top-nav-link">Login</a>
            <button id="aboutButton" class="about-button">Sobre</button>
        </div>

        <header>
            <h1>Bem-vindo √† Central de Jogos!</h1>
            <p>Escolha um dos nossos jogos cl√°ssicos para se divertir.</p>
        </header>

        <nav class="game-selection">
            <h2>Escolha seu Jogo:</h2>
            <ul>
                <li><a href="snake.html" class="game-link">Jogo da Cobrinha</a></li>
                <li><a href="pong.html" class="game-link">Pong Cl√°ssico</a></li>
                <li><a href="quebra_blocos.html" class="game-link">Quebra Blocos</a></li>
            </ul>
        </nav> <section class="ranking-section">
            <h2>üèÜ Ranking dos Melhores Jogadores üèÜ</h2>
            <p>Veja quem s√£o os mestres em nossos jogos!</p>
            <div class="ranking-game-selection">
                <button class="ranking-game-btn" data-gameid="snake">Jogo da Cobrinha</button>
                <button class="ranking-game-btn" data-gameid="pong">Pong Cl√°ssico</button>
                <button class="ranking-game-btn" data-gameid="quebra_blocos">Quebra Blocos</button>
            </div>
            <div id="rankingDisplayArea">
                <p class="ranking-placeholder">Selecione um jogo acima para ver o ranking.</p>
            </div>
        </section>

        <section class="adsense-area"> <h2>An√∫ncios</h2>
            <p>Espa√ßo reservado para an√∫ncios do Google AdSense. <br> Configure sua conta AdSense e cole o c√≥digo aqui para monetizar seu site.</p>
        </section>

        <footer>
            <p>&copy; 2025 Central de Jogos - Todos os direitos reservados.</p>
        </footer>
    </div> <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close-button about-modal-close">&times;</span>
            <h2>Sobre a Central de Jogos</h2>
            <p>Bem-vindo √† Central de Jogos! Este espa√ßo foi cuidadosamente desenvolvido por <strong><a href="https://www.instagram.com/mizykj/" target="_blank" rel="noopener noreferrer" class="inline-link">Mizy Dev</a></strong>.</p>
            <p>A principal motiva√ß√£o por tr√°s da cria√ß√£o deste site √© simples: trazer divers√£o e um toque de nostalgia atrav√©s de jogos cl√°ssicos que marcaram gera√ß√µes. Queremos oferecer um local onde voc√™ possa relaxar, desafiar a si mesmo e, quem sabe, relembrar bons momentos.</p>
            <p>Cada jogo foi implementado com o intuito de ser leve, acess√≠vel e f√°cil de jogar. Esperamos que voc√™ desfrute da experi√™ncia tanto quanto n√≥s gostamos de cri√°-la.</p>
            <p>Divirta-se!</p>
            <p><em>- <a href="https://www.instagram.com/mizykj/" target="_blank" rel="noopener noreferrer" class="inline-link">Mizy Dev</a></em></p>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content auth-modal-content">
            <span class="close-button auth-modal-close">&times;</span>
            <div class="auth-form" id="loginContainerModal">
                <h3>Acesse sua Conta</h3>
                <form id="formLoginModal">
                    <div><label for="loginEmailModal">Email:</label><input type="email" id="loginEmailModal" name="loginEmailModal" required></div>
                    <div><label for="loginSenhaModal">Senha:</label><input type="password" id="loginSenhaModal" name="loginSenhaModal" required></div>
                    <button type="submit">Entrar</button>
                </form>
                <p class="toggle-form-link">N√£o possui uma conta? <a href="#" id="switchToRegisterInModalLink">Crie uma</a></p>
            </div>
            <div class="auth-form" id="registroContainerModal" style="display: none;">
                <h3>Crie sua Conta</h3>
                <form id="formRegistroModal">
                    <div><label for="registroEmailModal">Email:</label><input type="email" id="registroEmailModal" name="registroEmailModal" required></div>
                    <div><label for="registroSenhaModal">Senha (m√≠n. 6 caracteres):</label><input type="password" id="registroSenhaModal" name="registroSenhaModal" required minlength="6"></div>
                    <div><label for="registroConfirmaSenhaModal">Confirmar Senha:</label><input type="password" id="registroConfirmaSenhaModal" name="registroConfirmaSenhaModal" required minlength="6"></div>
                    <button type="submit">Registrar</button>
                </form>
                <p class="toggle-form-link">J√° possui uma conta? <a href="#" id="switchToLoginInModalLink">Fa√ßa login</a></p>
            </div>
            <p id="authMessageModal" class="auth-message"></p>
        </div>
    </div>

    <script>
        const aboutModalElement = document.getElementById('aboutModal'); // Renomeado para evitar conflito de nome
        const aboutBtnElement = document.getElementById('aboutButton'); // Renomeado
        if (aboutModalElement) { // Verifica se o modal existe antes de adicionar listeners
            const aboutModalCloseBtnElement = aboutModalElement.querySelector('.about-modal-close');

            if (aboutBtnElement) {
                aboutBtnElement.onclick = function() {
                    aboutModalElement.style.display = 'flex';
                    setTimeout(function() { aboutModalElement.classList.add('modal-visible'); }, 10);
                    document.body.classList.add('modal-open');
                }
            }
            function closeAboutModal() {
                aboutModalElement.classList.remove('modal-visible');
                document.body.classList.remove('modal-open');
                setTimeout(function() {
                    if (!aboutModalElement.classList.contains('modal-visible')) { aboutModalElement.style.display = 'none'; }
                }, 300);
            }
            if (aboutModalCloseBtnElement) aboutModalCloseBtnElement.onclick = closeAboutModal;
            
            window.addEventListener('click', function(event) {
                if (event.target == aboutModalElement) { // Verifica se o clique foi no overlay do modal "Sobre"
                    closeAboutModal();
                }
            });
        }
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
      import { getFirestore, collection, addDoc, serverTimestamp, query, where, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js"; // Adicionado query, where, orderBy, limit, getDocs

      // SUA CONFIGURA√á√ÉO DO FIREBASE - VERIFIQUE E USE OS SEUS VALORES REAIS!
      const firebaseConfig = {
        apiKey: "AIzaSyBYLGHFCAe_Go88NLg9huffQcaH65O8AxU", // SUBSTITUA PELO SEU VALOR REAL
        authDomain: "central-de-jogos-4bdf1.firebaseapp.com", // SUBSTITUA PELO SEU VALOR REAL
        projectId: "central-de-jogos-4bdf1", // SUBSTITUA PELO SEU VALOR REAL
        storageBucket: "central-de-jogos-4bdf1.appspot.com", // CONFIRA ESTE VALOR NO SEU CONSOLE!
        messagingSenderId: "552827412845", // SUBSTITUA PELO SEU VALOR REAL
        appId: "1:552827412845:web:57af946ce0b1a53a113a64", // SUBSTITUA PELO SEU VALOR REAL
        measurementId: "G-RDL4Y8ELKQ" // SUBSTITUA (opcional)
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      console.log("Firebase Modular SDK inicializado (Auth e Firestore prontos) em index.html!");

      window.firebaseAppInstance = app;
      window.firebaseAuthInstance = auth;
      window.firebaseDbInstance = db;

      window.fbCreateUser = (email, password) => createUserWithEmailAndPassword(auth, email, password);
      window.fbSignIn = (email, password) => signInWithEmailAndPassword(auth, email, password);
      window.fbSignOut = () => signOut(auth);
      window.fbOnAuthStateChanged = (callback) => onAuthStateChanged(auth, callback);

      // Fun√ß√µes do Firestore expostas para ranking
      window.fbGetCollection = (collectionName) => collection(db, collectionName);
      window.fbQuery = (ref, ...constraints) => query(ref, ...constraints); // Adicionado para query
      window.fbWhere = (field, op, value) => where(field, op, value); // Adicionado para where
      window.fbOrderBy = (field, direction) => orderBy(field, direction); // Adicionado para orderBy
      window.fbLimit = (count) => limit(count); // Adicionado para limit
      window.fbGetDocs = (query) => getDocs(query); // Adicionado para getDocs
      window.fbAddDoc = (collectionName, data) => addDoc(collection(db, collectionName), data); // J√° existia para score
      window.fbServerTimestamp = () => serverTimestamp(); // J√° existia para score
      
      window.dispatchEvent(new CustomEvent('firebaseReady'));
      console.log("'firebaseReady' event dispatched from index.html!");
    </script>

    <script>
        window.addEventListener('firebaseReady', () => {
            console.log("Evento 'firebaseReady' recebido no script principal do index.html!");
            
            // Inst√¢ncias do Firebase (j√° est√£o globais, mas podemos peg√°-las para clareza local)
            const authInstance = window.firebaseAuthInstance;
            const dbInstance = window.firebaseDbInstance;

            // ------ L√ìGICA DA UI DE AUTENTICA√á√ÉO (MODAL DE LOGIN/REGISTRO) ------
            const loginTriggerLink = document.getElementById('loginTriggerLink');
            const loggedInUserInfo = document.getElementById('loggedInUserInfo');
            const loggedInUserEmailDisplay = document.getElementById('loggedInUserEmail');
            const logoutModalButton = document.getElementById('logoutModalButton');
            const authModalElement = document.getElementById('authModal'); // Renomeado para evitar conflito
            
            if (authModalElement) { // Verifica se o modal de auth existe
                const authModalCloseBtnElement = authModalElement.querySelector('.auth-modal-close');
                const loginContainerModal = document.getElementById('loginContainerModal');
                const registroContainerModal = document.getElementById('registroContainerModal');
                const formLoginModal = document.getElementById('formLoginModal');
                const loginEmailModalInput = document.getElementById('loginEmailModal');
                const loginSenhaModalInput = document.getElementById('loginSenhaModal');
                const formRegistroModal = document.getElementById('formRegistroModal');
                const registroEmailModalInput = document.getElementById('registroEmailModal');
                const registroSenhaModalInput = document.getElementById('registroSenhaModal');
                const registroConfirmaSenhaModalInput = document.getElementById('registroConfirmaSenhaModal');
                const switchToRegisterInModalLink = document.getElementById('switchToRegisterInModalLink');
                const switchToLoginInModalLink = document.getElementById('switchToLoginInModalLink');
                const authMessageModal = document.getElementById('authMessageModal');

                function mostrarMensagemAuthModal(mensagem, tipo = 'error') {
                    authMessageModal.textContent = mensagem;
                    authMessageModal.className = 'auth-message ';
                    if (tipo === 'success') authMessageModal.classList.add('success');
                    else authMessageModal.classList.add('error');
                }
                function openAuthModal(view = 'login') {
                    if (view === 'login') { loginContainerModal.style.display = 'block'; registroContainerModal.style.display = 'none'; }
                    else { loginContainerModal.style.display = 'none'; registroContainerModal.style.display = 'block'; }
                    authMessageModal.textContent = ''; authMessageModal.className = 'auth-message';
                    authModalElement.style.display = 'flex';
                    setTimeout(() => { authModalElement.classList.add('modal-visible'); }, 10);
                    document.body.classList.add('modal-open');
                }
                function closeAuthModal() {
                    authModalElement.classList.remove('modal-visible');
                    document.body.classList.remove('modal-open');
                    setTimeout(() => { if (!authModalElement.classList.contains('modal-visible')) { authModalElement.style.display = 'none'; }}, 300);
                }

                if (loginTriggerLink) loginTriggerLink.addEventListener('click', (e) => { e.preventDefault(); openAuthModal('login'); });
                if (authModalCloseBtnElement) authModalCloseBtnElement.onclick = closeAuthModal;
                window.addEventListener('click', function(event) { if (event.target == authModalElement) closeAuthModal(); });
                if (switchToRegisterInModalLink) switchToRegisterInModalLink.addEventListener('click', (e) => { e.preventDefault(); openAuthModal('register'); });
                if (switchToLoginInModalLink) switchToLoginInModalLink.addEventListener('click', (e) => { e.preventDefault(); openAuthModal('login'); });

                if (formRegistroModal) {
                    formRegistroModal.addEventListener('submit', async (e) => {
                        e.preventDefault(); const email = registroEmailModalInput.value; const senha = registroSenhaModalInput.value; const cSenha = registroConfirmaSenhaModalInput.value;
                        if (senha.length < 6) { mostrarMensagemAuthModal('Senha: m√≠n. 6 caracteres.'); return; } if (senha !== cSenha) { mostrarMensagemAuthModal('As senhas n√£o coincidem!'); return; }
                        try { await window.fbCreateUser(email, senha); formRegistroModal.reset(); }
                        catch (error) { console.error("Erro no registro (index.html):", error); if (error.code === 'auth/email-already-in-use') mostrarMensagemAuthModal('Este email j√° est√° em uso.'); else if (error.code === 'auth/weak-password') mostrarMensagemAuthModal('Senha fraca.'); else mostrarMensagemAuthModal('Erro ao registrar: ' + error.message.replace('Firebase: ',''));}
                    });
                }
                if (formLoginModal) {
                    formLoginModal.addEventListener('submit', async (e) => {
                        e.preventDefault(); const email = loginEmailModalInput.value; const senha = loginSenhaModalInput.value;
                        try { await window.fbSignIn(email, senha); formLoginModal.reset(); }
                        catch (error) { console.error("Erro no login (index.html):", error); if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential' || error.code === 'auth/invalid-email') mostrarMensagemAuthModal('Email ou senha inv√°lidos.'); else mostrarMensagemAuthModal('Erro ao fazer login: ' + error.message.replace('Firebase: ',''));}
                    });
                }
                if (logoutModalButton) {
                    logoutModalButton.addEventListener('click', async (e) => {
                        e.preventDefault(); try { await window.fbSignOut(); } catch (error) { console.error("Erro no logout (index.html):", error); }
                    });
                }

                // Observador do estado de autentica√ß√£o para a UI do topo
                if (window.fbOnAuthStateChanged && authInstance) { // Usa authInstance que pegamos de window.firebaseAuthInstance
                    window.fbOnAuthStateChanged(user => {
                        if (user) {
                            if (loggedInUserInfo) loggedInUserInfo.style.display = 'flex';
                            if (loggedInUserEmailDisplay) loggedInUserEmailDisplay.textContent = user.email;
                            if (loginTriggerLink) loginTriggerLink.style.display = 'none';
                            closeAuthModal(); // Fecha o modal se estiver aberto ap√≥s login/registro
                        } else {
                            if (loggedInUserInfo) loggedInUserInfo.style.display = 'none';
                            if (loginTriggerLink) loginTriggerLink.style.display = 'inline-block';
                        }
                    });
                } else {
                     console.error("Inst√¢ncia de Auth ou fbOnAuthStateChanged n√£o pronta para UI do index.html.");
                }
            } // Fim do if (authModalElement)

            // ------ L√ìGICA DO RANKING ------
            const rankingGameButtons = document.querySelectorAll('.ranking-game-btn');
            const rankingDisplayArea = document.getElementById('rankingDisplayArea');
            const rankingPlaceholder = document.querySelector('#rankingDisplayArea .ranking-placeholder'); // Mais espec√≠fico

            if (rankingGameButtons.length > 0 && rankingDisplayArea && dbInstance) { // Usa dbInstance
                rankingGameButtons.forEach(button => {
                    button.addEventListener('click', async () => {
                        const gameId = button.dataset.gameid;
                        rankingGameButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        if (rankingPlaceholder) rankingPlaceholder.style.display = 'none';
                        rankingDisplayArea.innerHTML = '<p class="ranking-placeholder">Carregando ranking...</p>';

                        try {
                            // Usando as fun√ß√µes globais para construir a query modular
                            const scoresCollectionRef = window.fbGetCollection("pontuacoes");
                            const q = window.fbQuery(
                                scoresCollectionRef,
                                window.fbWhere("gameId", "==", gameId),
                                window.fbOrderBy("score", "desc"),
                                window.fbLimit(10)
                            );
                            const querySnapshot = await window.fbGetDocs(q);

                            if (querySnapshot.empty) {
                                rankingDisplayArea.innerHTML = '<p class="ranking-placeholder">Nenhuma pontua√ß√£o encontrada para este jogo ainda!</p>';
                                return;
                            }
                            let rankingHtml = '<table><thead><tr><th>#</th><th>Jogador</th><th>Pontua√ß√£o</th></tr></thead><tbody>';
                            let rank = 1;
                            querySnapshot.forEach(doc => {
                                const data = doc.data();
                                const userEmailEscaped = data.userEmail ? data.userEmail.replace(/</g, "&lt;").replace(/>/g, "&gt;") : "An√¥nimo";
                                rankingHtml += `<tr><td>${rank}</td><td>${userEmailEscaped}</td><td>${data.score}</td></tr>`;
                                rank++;
                            });
                            rankingHtml += '</tbody></table>';
                            rankingDisplayArea.innerHTML = rankingHtml;
                        } catch (error) {
                            console.error("Erro ao buscar ranking: ", error);
                            rankingDisplayArea.innerHTML = '<p class="ranking-placeholder" style="color: red;">Erro ao carregar o ranking.</p>';
                        }
                    });
                });
            } else {
                // Logs de aviso se elementos n√£o forem encontrados
            }
        }); // Fim do window.addEventListener('firebaseReady', ...)
    </script>
</body>
</html>
